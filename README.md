# Kartica Flashcards

Простое SPA для изучения слов с помощью флешкарточек. Приложение адаптировано под мобильные устройства, может быть установлено как PWA и поддерживает кастомизацию темы через Telegram WebApp API.

Основные возможности:

- просмотр готовых тем с карточками и запуск режима обучения;
- автоматическое сохранение истории открытых групп и быстрый доступ к ним в профиле;
- добавление групп в избранное и синхронизация отметок с сервером;
- REST API для чтения и создания групп/карточек, обновления истории и лайков.

## Требования

- Node.js 18+
- Утилита `sqlite3` (используется для применения миграций и сидов)

## Установка зависимостей

```bash
npm install
```

## Локальный запуск

1. Примените миграции и запустите сервер:
   ```bash
   npm start
   ```
   При первом запуске сервер автоматически создаст файл базы данных `prisma/dev.db` и применит миграцию.
2. Откройте приложение по адресу `http://localhost:3000`. Бэкенд отдаёт как API, так и статические файлы фронтенда, поэтому дополнительный фронтенд-сервер не требуется.
3. Документация API доступна по адресу `http://localhost:3000/api/docs`, OpenAPI-спецификация — по `http://localhost:3000/api/openapi.yaml`.

### Сидинг тестовых данных

Чтобы наполнить базу тестовой группой карточек «English», выполните:

```bash
npm run seed
```

Скрипт перезапишет содержимое таблиц и создаст 20 карточек с фразовыми глаголами.

### Переменные окружения

- `PORT` — порт HTTP-сервера (по умолчанию `3000`).
- `DATABASE_URL` — путь к файлу SQLite (по умолчанию `file:./prisma/dev.db`).
- `TELEGRAM_BOT_SECRET` — токен вашего бота, используется для проверки `X-Telegram-Data`.

### Аутентификация запросов

Все запросы к REST-эндпоинтам (`/api/**`) должны содержать заголовок `X-Telegram-Data` с оригинальной строкой `initData`, которую Telegram WebApp передаёт клиенту. Сервер проверяет подпись при помощи `TELEGRAM_BOT_SECRET` и создаёт пользователя в базе автоматически (по `telegramId`).

Для локальной отладки откройте приложение внутри Telegram-клиента, получите `window.Telegram.WebApp.initData` и пробрасывайте его в запросы с фронтенда. Без заголовка сервер вернёт `403 Access denied`.

### Основные эндпоинты

| Метод | Путь | Описание |
| --- | --- | --- |
| `GET` | `/api/groups` | Список групп вместе с карточками и признаком `isLiked`. |
| `POST` | `/api/groups` | Создание новой группы. |
| `GET` | `/api/groups/{groupId}` | Получение группы по идентификатору. |
| `POST` | `/api/groups/{groupId}/cards` | Добавление карточки в выбранную группу. |
| `POST` | `/api/groups/{groupId}/history` | Фиксация факта открытия группы текущим пользователем. |
| `POST`/`DELETE` | `/api/groups/{groupId}/like` | Добавление или удаление группы из избранного. |
| `GET` | `/api/me` | Профиль пользователя: история и избранные группы. |

## Запуск в Docker

1. Соберите образ:
   ```bash
   docker build -t kartica .
   ```
2. Запустите контейнер:
   ```bash
   docker run -p 3000:3000 kartica
   ```
   При старте контейнер выполнит миграции и сидинговый скрипт, после чего запустит бэкенд, который раздаёт статический фронтенд и API.

## Обновление и деплой

Для выката на сервер достаточно собрать Docker-образ из репозитория и запустить его на целевой инфраструктуре. При каждом запуске контейнера база данных будет автоматически создана (если её ещё нет) и заполнена демо-данными из сида; для сохранения состояния используйте volume, примонтированный к `/app/prisma`.
